<div class="right-sidebar">
  @if (loading) {
  <div class="text-center text-muted py-4">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>
  } @else if (error) {
  <div class="alert alert-danger text-center">{{ error }}</div>
  } @else {
  <div class="profile-card shadow-lg p-4 text-center position-relative">
    <div class="position-absolute top-0 end-0 p-2">
      <button class="btn btn-outline-secondary position-relative" (click)="toggleNotifications()">
        <i class="bi bi-bell" [class.bi-bell-fill]="showNotifications"></i>
        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
          *ngIf="(unreadCount$ | async) as count">
          {{ count }}
        </span>
      </button>
    </div>

    <h5 class="fw-bold text-dark mb-1">
      <i class="bi bi-person-circle me-1 large-icon"></i> {{ user?.userName }}
    </h5>
    <p class="text-muted small mb-1">
      <i class="bi bi-envelope me-1"></i> {{ user?.email }}
    </p>
    <span class="badge bg-gradient-primary role-badge mb-3 d-inline-block">
      <i class="bi bi-shield-lock me-1"></i> {{ user?.roles?.[0] }}
    </span>

    <button class="btn btn-outline-danger btn-sm w-100 mt-2" (click)="logout()">
      <i class="bi bi-box-arrow-right me-1"></i> Logout
    </button>
  </div>

  @if (showNotifications) {
  <div class="mt-3 p-3 border bg-light shadow-sm rounded notifications-panel">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h6 class="fw-bold mb-0">
        <i class="bi bi-bell-fill me-1"></i> Notifications
        <span class="badge bg-secondary ms-1">{{ (notifications$ | async)?.length || 0 }}</span>
      </h6>
      <div class="btn-group" role="group">
        <button class="btn btn-sm btn-outline-primary" (click)="markAllAsRead()" 
                *ngIf="(unreadCount$ | async) as count">
          <i class="bi bi-check-all"></i> Mark All Read
        </button>
        <button class="btn btn-sm btn-outline-danger" (click)="clearNotifications()">
          <i class="bi bi-x-circle"></i> Clear All
        </button>
      </div>
    </div>

    <div class="notifications-list">
      @if ((notifications$ | async)?.length === 0) {
      <div class="text-center text-muted py-3">
        <i class="bi bi-bell-slash display-6"></i>
        <p class="mb-0">No notifications</p>
      </div>
      } @else {
      @for (note of notifications$ | async; track note.id) {
      <div class="notification-item mb-2 p-2 border rounded" 
           [class.notification-unread]="!note.isRead"
           [class.notification-read]="note.isRead">
        
        <!-- Notification Header -->
        <div class="d-flex justify-content-between align-items-start mb-1">
          <div class="notification-type">
            <i class="bi me-1" 
               [class.bi-archive-fill]="note.type === 'warning'"
               [class.bi-check-circle-fill]="note.type === 'success'"
               [class.bi-info-circle-fill]="note.type === 'info'"
               [class.bi-exclamation-triangle-fill]="note.type === 'error'"
               [class.text-warning]="note.type === 'warning'"
               [class.text-success]="note.type === 'success'"
               [class.text-info]="note.type === 'info'"
               [class.text-danger]="note.type === 'error'"></i>
            <strong class="small">{{ note.action }}</strong>
          </div>
          <div class="notification-controls">
            <button class="btn btn-sm btn-outline-primary" (click)="markAsRead(note.id)" 
                    *ngIf="!note.isRead" title="Mark as read">
              <i class="bi bi-check"></i>
            </button>
            <button class="btn btn-sm btn-outline-danger" (click)="clearNotification(note.id)" 
                    title="Remove notification">
              <i class="bi bi-x"></i>
            </button>
          </div>
        </div>

        <!-- Notification Message -->
        <div class="notification-message mb-2">
          <small class="text-muted">{{ note.message }}</small>
        </div>

        <!-- File Details (if available) -->
        @if (note.fileName) {
        <div class="notification-details">
          <div class="row g-1 small">
            <div class="col-12">
              <i class="bi bi-file-earmark text-primary"></i> 
              <strong>File:</strong> {{ note.fileName }}{{ note.fileExtension }}
            </div>
            @if (note.itemName) {
            <div class="col-12">
              <i class="bi bi-box text-success"></i> 
              <strong>Item:</strong> {{ note.itemName }}
            </div>
            }
            @if (note.versionNumber) {
            <div class="col-6">
              <i class="bi bi-hash text-info"></i> 
              <strong>Version:</strong> {{ note.versionNumber }}
            </div>
            }
            @if (note.createdBy) {
            <div class="col-6">
              <i class="bi bi-person text-secondary"></i> 
              <strong>By:</strong> {{ note.createdBy }}
            </div>
            }
          </div>
        </div>
        }

        <!-- Notification Timestamp -->
        <div class="notification-timestamp mt-2">
          <small class="text-muted">
            <i class="bi bi-clock"></i> {{ getRelativeTime(note.timestamp) }}
          </small>
        </div>
      </div>
      }
      }
    </div>
  </div>
  }
  }
</div>